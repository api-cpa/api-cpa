<% content_for(:page_controls) { link_to t('actions.new'), new_back_office_user_path, class: 'btn btn-primary' } %>
<% content_for(:page_title) { t('.title') } %>

<div class="b-io-content--secondary">
  <div class="container-fluid">

    <table class="table table-sm table-hover table-link">
      <thead>
      <tr>
        <th colspan="2"></th>
        <th><%= t('activerecord.attributes.user.parent') %></th>
        <th class="width-20" colspan="<%= Role::USER_ROLES.size + 1 %>"><%= t('misc.roles') %></th>
        <th><%= t('activerecord.attributes.user.is_active') %></th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% @collection.each do |user| %>
      <tr data-link="<%= edit_back_office_user_path(user) %>">
        <td class="width-3">
          <i class="fa fa-fw fa-user fa-2x"></i>
        </td>
        <td>
          <strong><%= user.full_name %></strong><br />
          <small class="text-muted"><%= "<i class=\"fa fa-fw fa-lock\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"#{t('devise.confirmations.unconfirmed')}\"></i>".html_safe if user.confirmed_at.nil? %> <%= user.email %></small>
        </td>
        <td>
          <% if user.parent %>
            <%= user.parent.full_name %><br />
            <small class="text-muted"><%= "<i class=\"fa fa-fw fa-lock\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"#{t('devise.confirmations.unconfirmed')}\"></i>".html_safe if user.parent.confirmed_at.nil? %> <%= user.parent.email %></small>
          <% end %>
        </td>
        <% ([:superadmin] + Role::USER_ROLES).each do |scope| %>
          <td class="width-5">
            <% if user.has_role?(scope) %>
              <i class="fa fa-fw <%= t("roles.#{scope}.icon") %>" data-toggle="tooltip" data-placement="top" title="<%= t("roles.#{scope}.title") %>"></i>
            <% end %>
          </td>
        <% end %>
        <td>
          <%= link_to "<i class=\"fa fa-fw fa-toggle-#{user.is_active ? 'on' : 'off'}\"></i>".html_safe, toggle_is_active_back_office_user_path(user), title: (user.is_active ? t('actions.deactivate') : t('actions.activate')), data: {toggle: 'tooltip', placement: 'top'}, method: :put, class: 'btn btn-link btn-sm' %>
        </td>
        <td class="text-right">
          <%= link_to '<i class="fa fa-fw fa-pencil"></i>'.html_safe, edit_back_office_user_path(user), class: 'btn btn-secondary btn-sm', title: t('actions.edit'), data: {toggle: 'tooltip', placement: 'top'} %>
          <%= link_to '<i class="fa fa-fw fa-key"></i>'.html_safe, permissions_back_office_user_path(user), class: 'btn btn-secondary btn-sm', title: t('misc.permissions'), data: {toggle: 'tooltip', placement: 'top'} %>
          <%= link_to '<i class="fa fa-fw fa-sign-in"></i>'.html_safe, sign_in_as_back_office_user_path(user), class: 'btn btn-secondary btn-sm', title: t('actions.sign_in_as'), data: {toggle: 'tooltip', placement: 'top'}, method: :put %>
          <%= link_to '<i class="fa fa-fw fa-trash"></i>'.html_safe, back_office_user_path(user), class: 'btn btn-danger btn-sm', title: t('actions.destroy'), data: {confirm: 'Are you sure?', toggle: 'tooltip', placement: 'top'}, method: :delete %>
        </td>
      </tr>
      <% end %>
      </tbody>
    </table>

  </div>
</div>
